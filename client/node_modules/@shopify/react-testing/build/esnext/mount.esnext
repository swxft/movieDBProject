import { Root } from './root';
import { Element } from './element';
export { Root, Element };
export function mount(element) {
  return new Root(element);
}
export class CustomRoot extends Root {
  constructor(tree, context, options) {
    super(tree, options);
    this.context = context;
  }

}
export function createMount({
  render,
  context: createContext = defaultContext,
  afterMount = defaultAfterMount
}) {
  function mount(element, options = {}) {
    const context = createContext(options);
    const wrapper = new CustomRoot(element, context, {
      render: element => render(element, context, options),
      resolveRoot: root => root.find(element.type)
    });
    const afterMountResult = afterMount(wrapper, options);
    return afterMountResult != null && 'then' in afterMountResult ? afterMountResult.then(() => wrapper) : wrapper;
  }

  Reflect.defineProperty(mount, 'extend', {
    writable: false,
    value: ({
      context: createAdditionalContext = defaultContext,
      render: additionalRender,
      afterMount: additionalAfterMount = defaultAfterMount
    }) => {
      return createMount({
        context: options => ({ ...createContext(options),
          ...createAdditionalContext(options)
        }),
        render: (element, context, options) => render(additionalRender(element, context, options), context, options),
        afterMount: (wrapper, options) => {
          const result = additionalAfterMount(wrapper, options);

          const finalResult = () => afterMount(wrapper, options);

          return result != null && 'then' in result ? result.then(finalResult) : finalResult();
        }
      });
    }
  });
  return mount;
}

function defaultContext() {
  return {};
}

function defaultAfterMount() {}